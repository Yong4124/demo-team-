<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head('채용공고 - 주한미군 전역장병 채용 플랫폼')}"></head>

<script>
    function adjustListMargin() {
        var searchArea = document.querySelector('.sub_search_area');
        var jobList = document.querySelector('.job_list');
        if (!searchArea || !jobList) return;
        
        if (window.innerWidth <= 1200) {
            var h = searchArea.offsetHeight + 100;
            jobList.style.marginTop = h + "px";
        } else {
            jobList.style.marginTop = "0px";
        }
    }
    window.addEventListener('load', adjustListMargin);
    window.addEventListener('resize', adjustListMargin);
</script>

<body class="sub">
<div class="wrapper">

    <!-- Header -->
    <th:block th:replace="~{fragments/header :: header}"></th:block>

    <form name="JobForm" method="get" th:action="@{/job/list}">
        <input type="hidden" name="page" th:value="${currentPage}"/>

        <div class="sub_container">
            <div class="container">
                <div class="sub_tit_wrap between">
                    <div class="sub_tit">채용공고</div>

                    <div class="sub_search_area">
                        <!-- 그룹사 선택 -->
                        <div class="sort_box">
                            <select class="select" name="groupCompany" id="groupCompany" onchange="this.form.submit();">
                                <option value="">그룹사 선택</option>
                                <option value="삼성" th:selected="${groupCompany == '삼성'}">삼성</option>
                                <option value="SK" th:selected="${groupCompany == 'SK'}">SK</option>
                                <option value="현대" th:selected="${groupCompany == '현대'}">현대</option>
                                <option value="LG" th:selected="${groupCompany == 'LG'}">LG</option>
                                <option value="롯데" th:selected="${groupCompany == '롯데'}">롯데</option>
                                <option value="한화" th:selected="${groupCompany == '한화'}">한화</option>
                                <option value="LS" th:selected="${groupCompany == 'LS'}">LS</option>
                                <option value="DL" th:selected="${groupCompany == 'DL'}">DL</option>
                                <option value="두산" th:selected="${groupCompany == '두산'}">두산</option>
                                <option value="기타" th:selected="${groupCompany == '기타'}">기타</option>
                            </select>
                        </div>

                        <!-- 검색 필드 -->
                        <div class="sort_box">
                            <select class="select" name="searchField" id="searchField">
                                <option value="ALL" th:selected="${searchField == 'ALL' or searchField == null}">전체</option>
                                <option value="TITLE" th:selected="${searchField == 'TITLE'}">공고명</option>
                                <option value="COMPANY" th:selected="${searchField == 'COMPANY'}">회사명</option>
                                <option value="LOCATION" th:selected="${searchField == 'LOCATION'}">근무처</option>
                            </select>
                        </div>

                        <!-- 검색어 -->
                        <div class="input_box">
                            <input type="text" class="input" name="keyword" id="keyword" 
                                   th:value="${keyword}" placeholder="검색어">
                            <a href="#" class="submit" onclick="this.closest('form').submit(); return false;"></a>
                        </div>

                        <!-- 정렬 -->
                        <div class="sort_box">
                            <select class="select" name="sortOption" id="sortOption" onchange="this.form.submit();">
                                <option value="START_DATE" th:selected="${sortOption == 'START_DATE' or sortOption == null}">시작일순</option>
                                <option value="END_DATE" th:selected="${sortOption == 'END_DATE'}">마감일순</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 채용공고 목록 -->
                <ul class="job_list">
                    <th:block th:each="job : ${jobPostings}">
                        <li>
                            <div class="box">
                                <div class="img">
                                    <img th:src="@{/img/common/default_logo.png}" alt="기업 로고">
                                </div>
                                <div class="job_linfo">
                                    <div class="ji_tit">
                                        <a th:href="@{/job/detail/{id}(id=${job.id})}" style="cursor:pointer; color:inherit;" th:text="${job.title}">공고 제목</a>
                                    </div>
                                    <div class="ji_linfo">
                                        <div class="item">
                                            <div class="th">직업유형</div>
                                            <div class="td" th:text="${job.jobType ?: '-'}">직업유형</div>
                                        </div>
                                        <div class="item">
                                            <div class="th">고용형태</div>
                                            <div class="td" th:text="${job.jobForm ?: '-'}">고용형태</div>
                                        </div>
                                        <div class="item">
                                            <div class="th">직종</div>
                                            <div class="td" th:text="${job.jobCategory ?: '-'}">직종</div>
                                        </div>
                                        <div class="item">
                                            <div class="th">업계</div>
                                            <div class="td" th:text="${job.industry ?: '-'}">업계</div>
                                        </div>
                                        <div class="item">
                                            <div class="th">직급</div>
                                            <div class="td" th:text="${job.roleLevel ?: '-'}">직급</div>
                                        </div>
                                        <div class="item">
                                            <div class="th">경력</div>
                                            <div class="td" th:text="${job.experience ?: '-'}">경력</div>
                                        </div>
                                        <div class="item">
                                            <div class="th">기본급</div>
                                            <div class="td" th:text="${job.baseSalary ?: '-'}">기본급</div>
                                        </div>
                                        <div class="item">
                                            <div class="th">근무시간</div>
                                            <div class="td" th:text="${job.workTime ?: '-'}">근무시간</div>
                                        </div>
                                        <div class="item full">
                                            <div class="th">근무처</div>
                                            <div class="td" th:text="${job.jobLocation ?: '-'}">근무처</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="job_rinfo">
                                    <div class="company_nm" th:text="${job.companyMember?.company ?: '회사명'}">회사명</div>
                                    <div class="date_info">
                                        <span th:text="${#temporals.format(job.startDate, 'yyyy-MM-dd')}">시작일</span> ~ 
                                        <span th:text="${#temporals.format(job.endDate, 'yyyy-MM-dd')}">마감일</span>
                                    </div>
                                    <a th:href="@{/job/detail/{id}(id=${job.id})}" class="btn-view">상세보기</a>
                                </div>
                            </div>
                        </li>
                    </th:block>

                    <!-- 데이터 없음 -->
                    <li th:if="${#lists.isEmpty(jobPostings)}">
                        <div class="box" style="text-align: center; padding: 60px;">
                            <p style="font-size: 18px; color: #666;">등록된 채용공고가 없습니다.</p>
                        </div>
                    </li>
                </ul>

                <!-- 페이징 -->
                <div class="page_wrap" th:if="${totalPages > 0}">
                    <div class="page_nation">
                        <a th:href="@{/job/list(page=0, keyword=${keyword}, searchField=${searchField}, groupCompany=${groupCompany}, sortOption=${sortOption})}" 
                           class="pprev" th:if="${currentPage > 0}">처음</a>
                        <a th:href="@{/job/list(page=${currentPage - 1}, keyword=${keyword}, searchField=${searchField}, groupCompany=${groupCompany}, sortOption=${sortOption})}" 
                           class="prev" th:if="${currentPage > 0}">이전</a>
                        
                        <th:block th:each="i : ${#numbers.sequence(startPage, endPage)}">
                            <a th:href="@{/job/list(page=${i}, keyword=${keyword}, searchField=${searchField}, groupCompany=${groupCompany}, sortOption=${sortOption})}"
                               th:text="${i + 1}" th:classappend="${i == currentPage} ? 'on' : ''">1</a>
                        </th:block>
                        
                        <a th:href="@{/job/list(page=${currentPage + 1}, keyword=${keyword}, searchField=${searchField}, groupCompany=${groupCompany}, sortOption=${sortOption})}" 
                           class="next" th:if="${currentPage < totalPages - 1}">다음</a>
                        <a th:href="@{/job/list(page=${totalPages - 1}, keyword=${keyword}, searchField=${searchField}, groupCompany=${groupCompany}, sortOption=${sortOption})}" 
                           class="nnext" th:if="${currentPage < totalPages - 1}">마지막</a>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Footer -->
    <footer th:replace="~{fragments/footer :: footer}"></footer>

</div>

<!-- Scripts -->
<th:block th:replace="~{fragments/footer :: scripts}"></th:block>

</body>
</html>
