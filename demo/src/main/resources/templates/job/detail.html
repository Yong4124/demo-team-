<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head('채용공고 상세 - 주한미군 전역장병 채용 플랫폼')}"></head>

<script th:inline="javascript">
    const jobId = [[${job.id}]];
    
    function goApply() {
        location.href = '/personal/apply/' + jobId;
    }
    
    function goList() {
        location.href = '/job/list';
    }
    
    function toggleFavorite(add) {
        const url = add ? '/personal/favorite/add' : '/personal/favorite/remove';
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'jobId=' + jobId
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || '처리 중 오류가 발생했습니다.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('처리 중 오류가 발생했습니다.');
        });
    }
    
    function goPrint() {
        window.print();
    }
</script>

<body class="sub">
<div class="wrapper">

    <!-- Header -->
    <th:block th:replace="~{fragments/header :: header}"></th:block>

    <div class="sub_container">
        <div class="container">
            <div class="job_view">
                <!-- 회사명 -->
                <div class="company_nm" th:text="${job.companyMember?.company ?: '회사명'}">회사명</div>
                
                <!-- 공고 제목 -->
                <div class="job_tit mb20" th:text="${job.title}">공고 제목</div>
                
                <!-- 접수기간 -->
                <div class="job_date">
                    <div class="th">접수기간</div>
                    <div class="td">
                        <span th:text="${#temporals.format(job.startDate, 'yyyy-MM-dd')}">시작일</span> ~ 
                        <span th:text="${#temporals.format(job.endDate, 'yyyy-MM-dd')}">마감일</span>
                        <span class="badge" th:if="${dDay >= 0}" th:text="'D-' + ${dDay}">D-7</span>
                        <span class="badge closed" th:if="${dDay < 0}">마감</span>
                    </div>
                </div>

                <!-- 채용 정보 -->
                <div class="job_info_box mb60">
                    <div class="job_info mar">
                        <div class="item">
                            <div class="th" style="width:130px">직업유형</div>
                            <div class="td" th:text="${job.jobType ?: '-'}">직업유형</div>
                        </div>
                        <div class="item">
                            <div class="th" style="width:130px">고용형태</div>
                            <div class="td" th:text="${job.jobForm ?: '-'}">고용형태</div>
                        </div>
                    </div>
                    <div class="job_info mar">
                        <div class="item">
                            <div class="th" style="width:130px">직종</div>
                            <div class="td" th:text="${job.jobCategory ?: '-'}">직종</div>
                        </div>
                        <div class="item">
                            <div class="th" style="width:130px">업계</div>
                            <div class="td" th:text="${job.industry ?: '-'}">업계</div>
                        </div>
                    </div>
                    <div class="job_info mar">
                        <div class="item">
                            <div class="th" style="width:130px">직급</div>
                            <div class="td" th:text="${job.roleLevel ?: '-'}">직급</div>
                        </div>
                        <div class="item">
                            <div class="th" style="width:130px">경력</div>
                            <div class="td" th:text="${job.experience ?: '-'}">경력</div>
                        </div>
                    </div>
                    <div class="job_info mar">
                        <div class="item">
                            <div class="th" style="width:130px">기본급</div>
                            <div class="td" th:text="${job.baseSalary ?: '-'}">기본급</div>
                        </div>
                        <div class="item">
                            <div class="th" style="width:130px">근무시간</div>
                            <div class="td" th:text="${job.workTime ?: '-'}">근무시간</div>
                        </div>
                    </div>
                    <div class="job_info half">
                        <div class="item">
                            <div class="th" style="width:130px">근무처</div>
                            <div class="td" th:text="${job.jobLocation ?: '-'}">근무처</div>
                        </div>
                    </div>
                </div>

                <!-- 회사소개 -->
                <div class="job_section mb60" th:if="${job.companyIntro}">
                    <div class="js_tit">회사소개</div>
                    <p th:text="${job.companyIntro}" style="white-space: pre-line;">회사소개 내용</p>
                </div>

                <!-- 담당업무 -->
                <div class="job_section mb60" th:if="${job.positionSummary}">
                    <div class="js_tit">담당업무</div>
                    <p th:text="${job.positionSummary}" style="white-space: pre-line;">담당업무 내용</p>
                </div>

                <!-- 기술 및 자격요건 -->
                <div class="job_section mb60" th:if="${job.skillQualification}">
                    <div class="js_tit">기술 및 자격요건</div>
                    <p th:text="${job.skillQualification}" style="white-space: pre-line;">자격요건 내용</p>
                </div>

                <!-- 복지 및 보상 -->
                <div class="job_section mb60" th:if="${job.benefits}">
                    <div class="js_tit">복지 및 보상</div>
                    <p th:text="${job.benefits}" style="white-space: pre-line;">복리후생 내용</p>
                </div>

                <!-- 유의사항 -->
                <div class="job_section mb60" th:if="${job.notes}">
                    <div class="js_tit">유의사항</div>
                    <p th:text="${job.notes}" style="white-space: pre-line;">유의사항 내용</p>
                </div>

                <!-- 회사정보 -->
                <div class="job_section mb60">
                    <div class="js_tit">회사정보</div>
                    <div class="job_info_box">
                        <div class="job_info diff half mar">
                            <div class="item">
                                <div class="th" style="width:130px">기업구분</div>
                                <div class="td" th:text="${job.companyType ?: '-'}">기업구분</div>
                            </div>
                            <div class="item">
                                <div class="th" style="width:130px">설립일</div>
                                <div class="td" th:text="${job.establishedDate ?: '-'}">설립일</div>
                            </div>
                        </div>
                        <div class="job_info diff half mar">
                            <div class="item">
                                <div class="th" style="width:130px">사원수</div>
                                <div class="td" th:text="${job.employeeNum ?: '-'}">사원수</div>
                            </div>
                            <div class="item">
                                <div class="th" style="width:130px">자본금</div>
                                <div class="td" th:text="${job.capital ?: '-'}">자본금</div>
                            </div>
                        </div>
                        <div class="job_info diff half">
                            <div class="item">
                                <div class="th" style="width:130px">매출액</div>
                                <div class="td" th:text="${job.revenue ?: '-'}">매출액</div>
                            </div>
                            <div class="item">
                                <div class="th" style="width:130px">홈페이지</div>
                                <div class="td break">
                                    <a th:if="${job.homepage}" th:href="${job.homepage}" th:text="${job.homepage}" target="_blank">홈페이지</a>
                                    <span th:unless="${job.homepage}">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 버튼 영역 -->
                <div class="btn_area center btnin">
                    <!-- 개인회원: 지원하기 -->
                    <th:block sec:authorize="hasRole('PERSONAL')">
                        <th:block th:if="${dDay >= 0}">
                            <button type="button" class="btn-submit mar" th:if="${!hasApplied}" onclick="goApply();">지원하기</button>
                            <button type="button" class="btn-submit mar disabled" th:if="${hasApplied}" disabled>지원완료</button>
                        </th:block>
                        <button type="button" class="btn-submit mar" onclick="goPrint();">인쇄하기</button>
                        <button type="button" class="btn-submit mar" th:if="${!isFavorite}" onclick="toggleFavorite(true);">관심기업 등록</button>
                        <button type="button" class="btn-submit mar" th:if="${isFavorite}" onclick="toggleFavorite(false);">관심기업 해제</button>
                    </th:block>
                    
                    <!-- 비로그인: 로그인 유도 -->
                    <th:block sec:authorize="!isAuthenticated()">
                        <a th:href="@{/auth/login}" class="btn-submit mar">로그인 후 지원</a>
                        <button type="button" class="btn-submit mar" onclick="goPrint();">인쇄하기</button>
                    </th:block>
                    
                    <!-- 기업회원 -->
                    <th:block sec:authorize="hasRole('COMPANY')">
                        <button type="button" class="btn-submit mar" onclick="goPrint();">인쇄하기</button>
                    </th:block>
                    
                    <button type="button" class="btn-cancel" onclick="goList();">목록가기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer th:replace="~{fragments/footer :: footer}"></footer>

</div>

<!-- Scripts -->
<th:block th:replace="~{fragments/footer :: scripts}"></th:block>

</body>
</html>
