<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('관심기업 - 주한미군 전역장병 채용 플랫폼')}"></head>

<body class="sub">
<div class="wrapper">

    <th:block th:replace="~{fragments/header :: header}"></th:block>

    <div class="sub_container">
        <div class="container">

            <div th:replace="~{personal/fragments/sidebar :: sidebar('favorites')}"></div>

            <div class="sub_tit mb20">관심기업</div>
            <div class="sub_txt mb60">관심 등록한 채용공고 목록입니다.</div>

            <div class="table_wrap">
                <table class="data_table">
                    <colgroup>
                        <col width="8%"><col width="*"><col width="18%"><col width="15%"><col width="12%">
                    </colgroup>
                    <thead>
                        <tr><th>번호</th><th>공고명</th><th>회사명</th><th>마감일</th><th>관리</th></tr>
                    </thead>
                    <tbody>
                        <tr th:each="fav, stat : ${favorites}">
                            <td th:text="${stat.count}">1</td>
                            <td style="text-align:left;"><a th:href="@{/job/detail/{id}(id=${fav.jobPosting.id})}" th:text="${fav.jobPosting.title}">공고제목</a></td>
                            <td th:text="${fav.jobPosting.companyMember?.company}">회사명</td>
                            <td th:text="${#temporals.format(fav.jobPosting.endDate, 'yyyy-MM-dd')}">2025-01-31</td>
                            <td><button type="button" class="btn-sm-cancel" onclick="removeFavorite([[${fav.jobPosting.id}]])">삭제</button></td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(favorites)}">
                            <td colspan="5" style="text-align:center; padding:60px;">
                                <p style="font-size:18px; color:#666; margin-bottom:20px;">관심 등록한 채용공고가 없습니다.</p>
                                <a th:href="@{/job/list}" class="btn-submit">채용공고 보러가기</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer th:replace="~{fragments/footer :: footer}"></footer>
</div>
<th:block th:replace="~{fragments/footer :: scripts}"></th:block>
<script>
function removeFavorite(jobId) {
    if (!confirm('관심기업에서 삭제하시겠습니까?')) return;
    fetch('/personal/favorite/remove', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'jobId=' + jobId
    }).then(res => res.json()).then(data => {
        if (data.success) location.reload();
        else alert(data.message || '오류가 발생했습니다.');
    });
}
</script>
<style>
.data_table { width:100%; border-collapse:collapse; }
.data_table th, .data_table td { padding:15px; border-bottom:1px solid #eee; text-align:center; }
.data_table th { background:#f8f9fa; font-weight:600; }
.data_table td a { color:#333; }
.data_table td a:hover { color:#255EB8; }
.btn-sm-cancel { padding:8px 15px; border:1px solid #ddd; background:#fff; border-radius:5px; cursor:pointer; }
.btn-sm-cancel:hover { background:#f5f5f5; }
</style>
</body>
</html>
