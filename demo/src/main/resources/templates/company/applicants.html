<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('지원자관리 - 주한미군 전역장병 채용 플랫폼')}"></head>

<body class="sub">
<div class="wrapper">

    <th:block th:replace="~{fragments/header :: header}"></th:block>

    <div class="sub_container">
        <div class="container">

            <div th:replace="~{company/fragments/sidebar :: sidebar('applicants')}"></div>

            <div class="sub_tit mb20">지원자관리</div>
            <div class="sub_txt mb60">채용공고에 지원한 지원자를 관리할 수 있습니다.</div>

            <!-- 공고 필터 -->
            <div class="filter_wrap mb30" style="display:flex; gap:15px; align-items:center;">
                <label>공고 선택:</label>
                <select id="jobFilter" class="select" style="min-width:300px;" onchange="filterByJob()">
                    <option value="">전체</option>
                    <option th:each="job : ${jobs}" th:value="${job.id}" th:text="${job.title}" th:selected="${selectedJobId == job.id}">공고명</option>
                </select>
            </div>

            <div class="table_wrap">
                <table class="data_table">
                    <colgroup>
                        <col width="8%"><col width="15%"><col width="*"><col width="15%"><col width="12%"><col width="15%">
                    </colgroup>
                    <thead>
                        <tr><th>번호</th><th>지원자</th><th>공고명</th><th>이메일</th><th>지원일</th><th>상태변경</th></tr>
                    </thead>
                    <tbody>
                        <tr th:each="app, stat : ${applicants}">
                            <td th:text="${stat.count}">1</td>
                            <td>
                                <a th:href="@{/company/applicant/{id}(id=${app.id})}" th:text="${app.personalMember?.firstName}">홍길동</a>
                            </td>
                            <td style="text-align:left;" th:text="${app.jobPosting?.title}">공고제목</td>
                            <td th:text="${app.personalMember?.email}">email@test.com</td>
                            <td th:text="${#temporals.format(app.createdAt, 'yyyy-MM-dd')}">2025-01-01</td>
                            <td>
                                <select class="select" style="font-size:13px;" th:onchange="'updateStatus(' + ${app.id} + ', this.value)'">
                                    <option value="접수완료" th:selected="${app.status == '접수완료' or app.status == null}">접수완료</option>
                                    <option value="서류검토중" th:selected="${app.status == '서류검토중'}">서류검토중</option>
                                    <option value="서류합격" th:selected="${app.status == '서류합격'}">서류합격</option>
                                    <option value="면접예정" th:selected="${app.status == '면접예정'}">면접예정</option>
                                    <option value="최종합격" th:selected="${app.status == '최종합격'}">최종합격</option>
                                    <option value="불합격" th:selected="${app.status == '불합격'}">불합격</option>
                                </select>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(applicants)}">
                            <td colspan="6" style="text-align:center; padding:60px;">
                                <p style="font-size:18px; color:#666;">지원자가 없습니다.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer th:replace="~{fragments/footer :: footer}"></footer>
</div>
<th:block th:replace="~{fragments/footer :: scripts}"></th:block>
<script>
function filterByJob() {
    const jobId = document.getElementById('jobFilter').value;
    location.href = '/company/applicants' + (jobId ? '?jobId=' + jobId : '');
}

function updateStatus(appId, status) {
    fetch('/company/applicant/status', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'applicationId=' + appId + '&status=' + encodeURIComponent(status)
    }).then(res => res.json()).then(data => {
        if (data.success) alert('상태가 변경되었습니다.');
        else alert(data.message || '오류가 발생했습니다.');
    });
}
</script>
<style>
.data_table { width:100%; border-collapse:collapse; }
.data_table th, .data_table td { padding:15px; border-bottom:1px solid #eee; text-align:center; }
.data_table th { background:#f8f9fa; font-weight:600; }
.data_table td a { color:#255EB8; font-weight:500; }
</style>
</body>
</html>
