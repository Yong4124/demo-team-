<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>주한미군 전역장병 채용 플랫폼</title>

    <!-- Swiper -->
    <link rel="stylesheet" type="text/css"
          href="https://fastly.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/sub.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/evidenceprime/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="/js/jobs.js" defer></script>
    <style>
        @media print {
            /* 인쇄 시 본문(body의 직접 자식들) 숨기기 */
            body > *:not(#resumeModal) {
                display: none !important;
            }

            /* 지원자 모달도 숨김 */
            #applicantModal {
                display: none !important;
            }

            /* 이력서 모달 인쇄 설정 */
            #resumeModal {
                position: static !important;
                background-color: transparent !important;
                overflow: visible !important;
                height: auto !important;
            }

            #resumeModal .modal_box {
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 20px !important;
                max-width: 100% !important;
            }

            #resumeModal .popup_scroll {
                max-height: none !important;
                overflow: visible !important;
                height: auto !important;
            }

            /* 인쇄 시 숨길 요소들 */
            .modal_close,
            .btn_area_wrap,
            .pform_tit_wrap .sort_box {
                display: none !important;
            }

            /* 페이지 나눔 방지 */
            .pop_box, .man_info, .popup_form > div {
                page-break-inside: avoid;
            }
        }
    </style>
</head>

<body class="sub">
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="wrapper">
    <div class="sub_container">
        <div class="container">

            <div class="sub_line_tab">
                <a href="/company/mypage">회원정보관리</a>
                <a href="/company/jobs" class="on">채용공고관리</a>
            </div>

            <!-- 타이틀 / 검색 -->
            <div class="sub_tit_wrap between">
                <div class="sub_tit">지원현황</div>

                <form name="rpForm" class="sub_search_area diff" onsubmit="goSearch(event); return false;">
                    <div class="sort_box">
                        <select class="select" name="searchfield">
                            <option value="ALL">전체</option>
                            <option value="TITLE">공고명</option>
                            <option value="JOB_LOCATION">근무처</option>
                        </select>
                    </div>

                    <div class="input_box" style="margin-right: 10px; position: relative;">
                        <input type="text" class="input" name="searchword" placeholder="검색어"
                               onkeypress="if(event.keyCode==13){event.preventDefault(); goSearch(event);}">
                        <a href="javascript:goSearch();" class="submit"></a>
                    </div>


                    <div class="sort_box">
                        <select class="select" name="searchtype" onchange="javascript:goSearch();">
                            <option value="ALL">전체</option>
                            <option value="1">공고중</option>
                            <option value="2">임시저장</option>
                        </select>
                    </div>
                </form>
            </div>

            <!-- 채용공고 목록 -->
            <ul class="job_list">
                <!-- JavaScript에서 동적으로 생성됨 -->
            </ul>

            <!-- 페이징 처리 -->
            <div class="page_wrap" style="display: block;">
                <div class="page_nation" id="pagination">
                    <!-- JavaScript에서 동적으로 생성됨 -->
                </div>
            </div>

            <!-- 등록 버튼 -->
            <div class="btn_area end">
                <a href="/company/jobs/write" class="btn-submit">등록하기</a>
            </div>

        </div>
    </div>
</div>

<!-- 지원자 모달 -->
<div id="applicantModal" class="modal"
     style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 9999; overflow: auto;">
    <div class="modal_box"
         style="position: relative; margin: 50px auto; max-width: 1020px; background: white; border-radius: 8px; padding: 40px;">
        <button class="modal_close" onclick="closeApplicantModal()"
                style="position: absolute; top: 20px; right: 20px; font-size: 30px; background: none; border: none; cursor: pointer;">
            &times;
        </button>

        <h2 class="pop_tit mb60" id="modalJobTitle">Production Team Member</h2>

        <div class="sub_tit_wrap between">
            <div class="sub_sstit">
                총지원자 수 : <b id="applicantCount">0</b>
            </div>

            <div class="sub_search_area diff">
                <div class="sort_box">
                    <select id="searchType" class="select">
                        <option value="ALL">전체</option>
                        <option value="NAME">이름</option>
                    </select>
                </div>

                <div class="input_box" style="margin-right: 10px">
                    <input type="text" id="applicantSearchWord" class="input" placeholder="검색어"
                           onkeypress="if(event.keyCode==13){ event.preventDefault(); loadApplicants(event); return false; }">
                    <a href="javascript:void(0);" onclick="loadApplicants(event);" class="submit"></a>
                </div>

                <div class="sort_box">
                    <select id="filterStatus" class="select" onchange="loadApplicants(event)">
                        <option value="">심사상태 선택</option>
                        <option value="0">미심사</option>
                        <option value="1">1차합격</option>
                        <option value="2">합격</option>
                        <option value="3">불합격</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="modal_content_area" style="max-height: 500px; overflow-y: auto;">
            <ul id="applicantList" class="jiwon_list">
            </ul>
        </div>
    </div>
</div>

<!-- 이력서 모달 -->
<div id="resumeModal" class="modal"
     style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 9999; overflow: auto;">
    <div class="modal_box"
         style="position: relative; margin: 50px auto; max-width: 1020px; background: white; border-radius: 8px; padding: 40px;">
        <button class="modal_close" onclick="closeResumeModal()"
                style="position: absolute; top: 20px; right: 20px; font-size: 30px; background: none; border: none; cursor: pointer;">
            &times;
        </button>

        <div class="pop_tit mb60" id="modalResumeJobTitle">Data Analysis Specialist</div>

        <div class="popup_scroll">
            <div class="popup_form">
                <!-- 인적사항 -->
                <div class="pform_tit_wrap mb30">
                    <div class="pform_tit">인적사항</div>
                    <div class="sort_box">
                        <select class="select" name="statusType" id="resumeStatusType">
                            <option value="">심사상태 선택</option>
                            <option value="1">1차 합격</option>
                            <option value="2">합격</option>
                            <option value="3">불합격</option>
                        </select>
                    </div>
                </div>

                <div class="pop_box mb60">
                    <div class="man_info">
                        <div class="img">
                            <img id="r_photo" src='/img/common/default_logo.png'
                                 onerror="this.onerror=null; this.src='/img/common/default_logo.png'"
                                 alt="이력서 사진">
                        </div>
                        <div class="info">
                            <div class="row">
                                <div class="item item1">
                                    <div class="field">
                                        <div class="th">이름</div>
                                        <div class="td"><input type="text" class="input" id="r_name" readonly></div>
                                    </div>
                                </div>
                                <div class="item item2">
                                    <div class="field">
                                        <div class="th">성별</div>
                                        <div class="td"><input type="text" class="input" id="r_gender" readonly></div>
                                    </div>
                                </div>
                                <div class="item item1">
                                    <div class="field">
                                        <div class="th">생년월일</div>
                                        <div class="td"><input type="text" class="input" id="r_birth" readonly></div>
                                    </div>
                                </div>
                                <div class="item item1">
                                    <div class="field">
                                        <div class="th">이메일</div>
                                        <div class="td"><input type="text" class="input" id="r_email" readonly></div>
                                    </div>
                                </div>
                                <div class="item item1">
                                    <div class="field">
                                        <div class="th">전화번호</div>
                                        <div class="td"><input type="text" class="input" id="r_phone" readonly></div>
                                    </div>
                                </div>
                                <div class="item">
                                    <div class="field">
                                        <div class="th">주소</div>
                                        <div class="td"><input type="text" class="input" id="r_address" readonly></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 최종학력 -->
                <div class="pform_tit mb30">최종학력</div>
                <div class="pop_box mb60">
                    <div class="man_info nopad">
                        <div class="info">
                            <div class="row">
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">학교</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_school" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">전공명</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_major" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">입학년월</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_entrance" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">졸업년월</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_grad" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">학점</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_score" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">졸업상태</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_status_edu"
                                                               readonly></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 전문분야 -->
                <div class="pform_tit mb30">전문분야</div>
                <div class="mb60">
                    <textarea class="textarea h200" id="r_field" readonly></textarea>
                </div>

                <!-- 경력 -->
                <div class="pform_tit mb30">경력</div>
                <div class="pop_box mb60">
                    <div class="man_info nopad">
                        <div class="info">
                            <div class="row">
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">회사명</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_company" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">부서명</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_dept" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">입사년월</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_join" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">퇴사년월</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_leave" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">직급/직책</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_position" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item item3">
                                    <div class="field">
                                        <div class="th">연봉</div>
                                        <div class="td"><input type="text" class="input mw250" id="r_salary" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="item">
                                    <div class="field xsblock">
                                        <div class="th">담당업무</div>
                                        <div class="td"><textarea class="textarea h100" id="r_task" readonly></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="item">
                                    <div class="field xsblock">
                                        <div class="th">경력기술서</div>
                                        <div class="td"><textarea class="textarea h100" id="r_career_desc"
                                                                  readonly></textarea></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 자격증 기술 -->
                <div class="pform_tit mb30">자격증 기술</div>
                <div id="r_cert_list">
                    <!-- 자격증 목록 동적 생성 -->
                </div>

                <!-- 자기소개서 -->
                <div class="pform_tit mb30">자기소개서</div>
                <div class="mb60">
                    <textarea class="textarea h200" id="r_intro" readonly></textarea>
                </div>

                <!-- 복무증명서 -->
                <div class="pform_tit mb30">'주한미군 전역장병 증빙자료' 또는 '복무증명서'</div>
                <div class="pop_box mb60">
                    <div class="down_view" id="r_service_proof_files">
                        <!-- 파일 목록 동적 생성 -->
                    </div>
                </div>

                <!-- 이력서 -->
                <div class="pform_tit mb30">이력서</div>
                <div class="pop_box mb60">
                    <div class="down_view" id="r_resume_files">
                        <!-- 파일 목록 동적 생성 -->
                    </div>
                </div>

            </div>
        </div>

        <!-- 버튼 영역 -->
        <div class="btn_area_wrap">
            <div class="btn_area center">
                <a href="#" class="btn-submit" onclick="window.print(); return false;">인쇄하기</a>
                <a href="#" class="btn-submit" onclick="downloadExcel(); return false;">액셀 다운로드</a>
                <a href="javascript:closeResumeModal();" class="btn-cancel">목록가기</a>
            </div>
        </div>
    </div>
</div>

<script>
    async function logout() {
        try {
            await fetch('/api/company/logout', {method: 'POST'});
            window.location.href = '/';
        } catch (error) {
            window.location.href = '/';
        }
    }
</script>

<div th:replace="~{fragments/footer :: footer}"></div>
<script src="/js/common.js"></script>
</body>
</html>