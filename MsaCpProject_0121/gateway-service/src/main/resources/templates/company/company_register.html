<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기업회원 가입 - 주한미군 전역장병 채용 플랫폼</title>

    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/sub.css">

    <style>
        /* 체크박스/라디오 버튼 스타일 */
        input[type="checkbox"],
        input[type="radio"] {
            -webkit-appearance: auto !important;
            -moz-appearance: auto !important;
            appearance: auto !important;
            display: inline-block !important;
            opacity: 1 !important;
            visibility: visible !important;
            position: relative !important;
            width: 16px !important;
            height: 16px !important;
            min-width: 16px !important;
            min-height: 16px !important;
            margin: 0 8px 0 0 !important;
            padding: 0 !important;
            cursor: pointer !important;
            border: 1px solid #999 !important;
            background: white !important;
            vertical-align: middle !important;
        }

        .icheck label,
        .iradio label {
            display: inline !important;
            position: relative !important;
            padding: 0 !important;
            margin: 0 !important;
            cursor: pointer !important;
            background: none !important;
            background-image: none !important;
            font-size: 14px !important;
            vertical-align: middle !important;
        }

        .icheck label::before,
        .icheck label::after,
        .iradio label::before,
        .iradio label::after {
            display: none !important;
            content: none !important;
        }

        .icheck_wrap,
        .iradio_wrap {
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 10px !important;
        }

        .icheck,
        .iradio {
            display: inline-flex !important;
            align-items: center !important;
            margin-right: 15px !important;
            margin-bottom: 10px !important;
        }
    </style>
</head>

<script type="text/javascript">
    var idChkFlag = false;
    var emailVerifiedFlag = false;
    var verificationCode = '';

    // 아이디 중복확인
    async function userIdChk() {
        var form = document.rpForm;
        if ((form.ID.value).length == 0) {
            alert('아이디를 입력해주세요.');
            form.ID.focus();
            return;
        }
        var idRegex = /^[A-Za-z0-9]{6,}$/;
        if (!idRegex.test(form.ID.value)) {
            alert('아이디는 6자 이상의 영문, 숫자를 포함해야 합니다.');
            form.ID.value = "";
            form.ID.focus();
            return;
        }
        try {
            const response = await fetch('/api/company/check-id/' + form.ID.value);
            const data = await response.json();
            if (data.exists) {
                alert('이미 사용중인 아이디입니다.');
                form.ID.value = "";
                idChkFlag = false;
            } else {
                alert('사용 가능한 아이디입니다.');
                idChkFlag = true;
            }
        } catch (error) {
            alert('ID 중복확인 중 오류가 발생했습니다.');
        }
    }

    // 이메일 인증번호 발송
    async function sendMail() {
        var form = document.rpForm;
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if ((form.EMAIL.value).length == 0) {
            alert('이메일을 입력해주세요.');
            form.EMAIL.focus();
            return;
        }
        if (!emailRegex.test(form.EMAIL.value)) {
            alert('유효한 이메일 형식이 아닙니다.');
            form.EMAIL.focus();
            return;
        }
        try {
            const response = await fetch('/api/company/send-verification', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: form.EMAIL.value })
            });
            const data = await response.json();
            if (data.success) {
                verificationCode = data.code;
                alert('인증번호가 발송되었습니다. (개발모드: ' + data.code + ')');
            } else {
                alert(data.message || '인증번호 발송에 실패했습니다.');
            }
        } catch (error) {
            alert('인증번호 발송 중 오류가 발생했습니다.');
        }
    }

    // 회원가입 처리
    async function goWriteAct() {
        var form = document.rpForm;
        
        // 기업정보 검증
        if ((form.COMPANY.value).length == 0) { alert('회사명을 입력해주세요.'); form.COMPANY.focus(); return; }
        if ((form.BUSINESS_REGIST_NUM.value).length == 0) { alert('사업자등록번호를 입력해주세요.'); form.BUSINESS_REGIST_NUM.focus(); return; }
        if ((form.PRESIDENT_NM.value).length == 0) { alert('대표자명을 입력해주세요.'); form.PRESIDENT_NM.focus(); return; }
        if ((form.COMPANY_ADDRESS.value).length == 0) { alert('회사 주소를 입력해주세요.'); form.COMPANY_ADDRESS.focus(); return; }
        
        // 담당자 정보 검증
        if ((form.ID.value).length == 0) { alert('아이디를 입력해주세요.'); form.ID.focus(); return; }
        if (!idChkFlag) { alert('아이디 중복확인을 해주세요.'); return; }
        if ((form.MANAGER_NM.value).length == 0) { alert('이름을 입력해주세요.'); form.MANAGER_NM.focus(); return; }
        if ((form.PW.value).length == 0) { alert('비밀번호를 입력해주세요.'); form.PW.focus(); return; }
        
        var pwRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,16}$/;
        if (!pwRegex.test(form.PW.value)) { 
            alert('비밀번호는 8~16자의 영문, 숫자, 특수기호를 포함해야 합니다.'); 
            form.PW.value = ""; 
            form.PW.focus(); 
            return; 
        }
        if ((form.PW_CF.value).length == 0) { alert('비밀번호 확인을 입력해주세요.'); form.PW_CF.focus(); return; }
        if (form.PW.value !== form.PW_CF.value) { alert('비밀번호가 일치하지 않습니다.'); form.PW_CF.value = ""; form.PW_CF.focus(); return; }
        if ((form.PHONE.value).length == 0) { alert('전화번호를 입력해주세요.'); form.PHONE.focus(); return; }
        
        // 개인정보 동의 확인
        if (!document.querySelector('input[name="AGREE"]:checked') || document.querySelector('input[name="AGREE"]:checked').value !== '1') { 
            alert('개인정보 수집, 이용에 동의해주세요.'); 
            return; 
        }
        
        // 이메일 인증 확인
        if ((form.EMAIL.value).length == 0) { alert('이메일을 입력해주세요.'); form.EMAIL.focus(); return; }
        
        // 인증번호 확인
        if ((form.CERTI_NUM.value).length == 0) { alert('인증번호를 입력해주세요.'); form.CERTI_NUM.focus(); return; }
        if (form.CERTI_NUM.value !== verificationCode) { alert('인증번호가 일치하지 않습니다.'); return; }

        const registerData = {
            loginId: form.ID.value,
            pw: form.PW.value,
            managerNm: form.MANAGER_NM.value,
            department: form.DEPARTMENT.value,
            phone: form.PHONE.value,
            email: form.EMAIL.value,
            businessRegistNum: form.BUSINESS_REGIST_NUM.value,
            company: form.COMPANY.value,
            presidentNm: form.PRESIDENT_NM.value,
            companyAddress: form.COMPANY_ADDRESS.value,
            parentCompanyCd: form.PARENT_COMPANY_CD.value || null
        };

        try {
            const response = await fetch('/api/company/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(registerData)
            });
            const data = await response.json();
            if (data.success) {
                alert('회원가입이 완료되었습니다. 관리자 승인 후 로그인이 가능합니다.');
                window.location.href = '/company/login';
            } else {
                alert(data.message || '회원가입에 실패했습니다.');
            }
        } catch (error) {
            alert('회원가입 중 오류가 발생했습니다.');
        }
    }
</script>

<body class="sub">

<div th:replace="~{fragments/navbar :: navbar}"></div>

<form name="rpForm" method="post">

<div class="wrapper">
    <div class="sub_container">
        <div class="container">
            <div class="join_view">
                <div class="sub_tit mb20">회원가입</div>
                <div class="sub_tab">
                    <a href="/register">개인회원</a>
                    <a href="#" class="on">기업회원</a>
                </div>

                <div class="join_box">
                    <!-- 기업정보 -->
                    <div class="join_tit">기업정보</div>
                    <div class="join_form join_form_line">
                        <div class="item">
                            <div class="field">
                                <div class="th">회사명</div>
                                <div class="td"><input type="text" name="COMPANY" class="input" maxlength="500"></div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="field">
                                <div class="th">사업자등록번호</div>
                                <div class="td"><input type="text" name="BUSINESS_REGIST_NUM" class="input" maxlength="500"></div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="field">
                                <div class="th">대표자명</div>
                                <div class="td"><input type="text" name="PRESIDENT_NM" class="input" maxlength="500"></div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="field">
                                <div class="th">그룹사</div>
                                <div class="td">
                                    <select name="PARENT_COMPANY_CD" class="select">
                                        <option value="">옵션선택</option>
                                        <option value="SAMSUNG">삼성</option>
                                        <option value="SK">SK</option>
                                        <option value="HYUNDAI">현대</option>
                                        <option value="LG">LG</option>
                                        <option value="LOTTE">롯데</option>
                                        <option value="HANWHA">한화</option>
                                        <option value="LS">LS</option>
                                        <option value="DL">DL</option>
                                        <option value="DOOSAN">두산</option>
                                        <option value="HANKOOKTIRE">한국타이어</option>
                                        <option value="HYOSUNG">효성</option>
                                        <option value="KUMHOTIRE">금호타이어</option>
                                        <option value="SOULBRAIN">솔브레인</option>
                                        <option value="SD">SD</option>
                                        <option value="ETC">기타</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="item full">
                            <div class="field">
                                <div class="th">회사주소(본사)</div>
                                <div class="td"><input type="text" name="COMPANY_ADDRESS" class="input" maxlength="1000"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 기업담당자 정보 -->
                    <div class="join_tit">기업담당자 정보</div>
                    <div class="join_form">
                        <div class="item full">
                            <div class="field xsshortmar">
                                <div class="th">아이디</div>
                                <div class="td">
                                    <div class="filebtn">
                                        <div class="filebtn_in">
                                            <input type="text" class="input" name="ID" maxlength="100" placeholder="6자 이상의 영문, 숫자" onchange="idChkFlag=false;">
                                            <a href="javascript:userIdChk();" class="fbtn noplus">중복확인</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="field">
                                <div class="th">이름</div>
                                <div class="td"><input type="text" name="MANAGER_NM" class="input" maxlength="500" placeholder="이름을 입력하세요"></div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="field">
                                <div class="th">비밀번호</div>
                                <div class="td"><input type="password" name="PW" class="input" maxlength="100" placeholder="8~16자의 영문, 숫자, 특수기호"></div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="field">
                                <div class="th">비밀번호 확인</div>
                                <div class="td"><input type="password" name="PW_CF" class="input" maxlength="100"></div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="field">
                                <div class="th">전화번호</div>
                                <div class="td"><input type="text" name="PHONE" class="input" maxlength="100"></div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="field">
                                <div class="th">부서</div>
                                <div class="td"><input type="text" name="DEPARTMENT" class="input" maxlength="500"></div>
                            </div>
                        </div>

                        <!-- 개인정보 동의 -->
                        <div class="item full">
                            <div class="field">
                                <div class="th">
                                    <div class="icheck">
                                        <div class="th">개인정보 수집, 이용을 동의합니다.
                                            <div class="iradio_wrap">
                                                <div class="iradio"><input type="radio" name="AGREE" id="AGREE1" value="1"><label for="AGREE1">예</label></div>
                                                <div class="iradio"><input type="radio" name="AGREE" id="AGREE2" value="2"><label for="AGREE2">아니요</label></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="td">
                              <textarea name="" id="" class="textarea h200" placeholder="" readonly>대한상공회의소(이하 "대한상의") 회원가입에 신청하시는 분께 수집하는 개인정보의 수집 및 이용목적, 개인정보의 항목, 개인정보의 보유 및 이용기간을 안내 드리오니 동의하여 주시기 바랍니다.

1. 개인정보의 수집 및 이용목적
주한미군 전역장병 채용 플랫폼은 다음의 목적을 위하여 개인정보를 처리합니다. 처리하고 있는 개인정보는 다음의 목적 이외의 용도로는 이용되지 않으며, 이용 목적이 변경되는 경우에는 개인정보 보호법 제15조에 따라 별도의 동의를 받는 등 필요한 조치를 이행할 예정입니다.

2. 수집하는 개인정보 항목
ㅇ 대한상의는 회원가입, 이용문의, 서비스 이용 등을 위해 아래와 같은 개인정보를 수집하고 있습니다.
- 개인회원 필수항목: 이름, 아이디, 비밀번호, 이메일, 생년월일, 성별, 거주지
- 개인회원 선택항목: 전화번호, 주소, 최종학력, 전문분야, 자격증, 자기소개서, 사진, 복무증명서, 이력서
- 기업회원 필수항목: 담당자명, 전화번호, 이메일, 아이디, 비밀번호
- 기업회원 선택항목: 채용 담당자명, 전화번호, 이메일

ㅇ 서비스 이용과정이나 사업처리 과정에서 아래와 같은 정보들이 자동으로 생성되어 수집될 수 있습니다.
IP Address, 방문 일시, 서비스 이용 기록, 부정 이용 기록

3. 개인정보의 보유 및 이용기간
회원의 개인정보는 원칙적으로 개인정보의 수집 및 이용목적이 달성되면 지체 없이 파기합니다.
- 보유 기간 : 회원 탈퇴시까지(단, 다음의 정보에 대해서는 아래의 이유로 명시한 기간 동안 보존합니다.)
- 보존 항목 : 아이디
- 보존 근거 : 서비스 중복 가입 방지
- 보존 기간 : 영구보관

4. 거부권 및 불이익
회원은 개인정보의 수집, 이용 등과 관련한 위 사항에 대하여 원하지 않는 경우 동의를 거부할 수 있습니다.
다만, 수집하는 개인정보의 항목에서 필수정보에 대한 수집 및 이용에 대하여 동의하지 않는 경우에는 온라인 회원가입을 하실 수 없습니다.</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- 이메일 인증 -->
                        <div class="item">
                            <div class="field xsshortmar">
                                <div class="th">이메일 인증</div>
                                <div class="td">
                                    <div class="filebtn">
                                        <div class="filebtn_in">
                                            <input type="text" class="input" name="EMAIL" id="EMAIL" placeholder="이메일" maxlength="100">
                                            <a href="javascript:sendMail();" class="fbtn noplus">인증번호 발송</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 인증번호 확인 -->
                        <div class="item">
                            <div class="field">
                                <div class="th">인증번호 확인</div>
                                <div class="td"><input type="text" class="input" name="CERTI_NUM" id="CERTI_NUM" oninput="this.value = this.value.replace(/[^0-9.-]/g, '').replace(/(\..*)\./g,'$1');" maxlength="6" placeholder="인증번호를 입력해주세요"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 가입하기 버튼 -->
                <div class="btn_area center">
                    <a href="javascript:goWriteAct();" class="btn-submit">가입하기</a>
                </div>
            </div>
        </div>
    </div>
</div>

    <div th:replace="~{fragments/footer :: footer}"></div>
</form>

<script src="/js/common.js?v=1"></script>
<script src="/js/main.js"></script>
</body>
</html>
